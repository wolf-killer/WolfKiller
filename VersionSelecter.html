<!DOCTYPE html> 
<html> 
<head> 
  <title>狼人殺</title> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta http-equiv="cache-control" content="no-cache" /> 
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <link rel="icon" type="image/x-icon" href="./image/WebIcon.png">
  <link rel="stylesheet" type="text/css" href="./Layout.css"/>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/notosanstc.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/cwtexyen.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">
  <!--icon list: https://icons.getbootstrap.com/ -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
  <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
  <script src="./long-press-event.min.js"></script>
  <script src="./GeneralFunction.js"></script>
  <script src="./Version.js"></script>
  <script src="./Definition.js"></script>
  <script src="./Translate.js"></script>
  <!--<script src="./Function.js"></script>-->
</head>  
<body oncontextmenu="return false;"> 
	<div id="FixScreen" class="w3-display-container"> 
		<div id="versionSelecter" class="PopupInfo w3-container w3-center w3-round-xxlarge" style="">
			<div id="defaultVersionTitle" class="extandSectionTitle w3-display-container w3-center w3-col-middle w3-pale-blue w3-leftbar w3-rightbar w3-border-blue w3-margin-top"
				 ondblclick="ExtandSection($(this).find('i'), 'defaultVersionSection')">
				預設組合
				<i class="bi bi-caret-down-fill w3-display-right w3-margin-right" onclick="ExtandSection(this, 'defaultVersionSection')"></i>
			</div>
			<div id="defaultVersionSection" class="w3-container w3-row-padding w3-stretch w3-hide w3-tiny"> 
				<div class="s2 m2 l1 w3-col w3-center w3-col-middle" onclick="selectVersion(6)">
					<button class="wolf-btn w3-btn w3-block w3-round-large">
						<i class="bi bi-person"></i>x 6
					</button>
				</div>
				<div class="s2 m2 l1 w3-col w3-center w3-col-middle" onclick="selectVersion(7)">
					<button class="wolf-btn w3-btn w3-block w3-round-large">
						<i class="bi bi-person"></i>x 7
					</button>
				</div>
				<div class="s2 m2 l1 w3-col w3-center w3-col-middle" onclick="selectVersion(8)">
					<button class="wolf-btn w3-btn w3-block w3-round-large">
						<i class="bi bi-person"></i>x 8
					</button>
				</div>
				<div class="s2 m2 l1 w3-col w3-center w3-col-middle" onclick="selectVersion(9)">
					<button class="wolf-btn w3-btn w3-block w3-round-large">
						<i class="bi bi-person"></i>x 9
					</button>
				</div>
				<div class="s2 m2 l1 w3-col w3-center w3-col-middle" onclick="selectVersion(10)">
					<button class="wolf-btn w3-btn w3-block w3-round-large">
						<i class="bi bi-person"></i>x 10
					</button>
				</div>
				<div class="s2 m2 l1 w3-col w3-center w3-col-middle" onclick="selectVersion(11)">
					<button class="wolf-btn w3-btn w3-block w3-round-large">
						<i class="bi bi-person"></i>x 11
					</button>
				</div>
				<div class="s2 m2 l1 w3-col w3-center w3-col-middle" onclick="selectVersion(12)">
					<button class="wolf-btn w3-btn w3-block w3-round-large">
						<i class="bi bi-person"></i>x 12
					</button>
				</div>
				<div class="s2 m2 l1 w3-col w3-center w3-col-middle" onclick="selectVersion(0)">
					<button class="wolf-btn w3-btn w3-block w3-round-large">
						重設
					</button>
				</div>
			</div>
			
			<div id="VillagerActorTitle" class="extandSectionTitle w3-display-container w3-center w3-col-middle w3-pale-blue w3-leftbar w3-rightbar w3-border-blue"
				 ondblclick="ExtandSection($(this).find('i'), 'VillagerActorSection')">
				平民陣營
				<i class="bi bi-info-circle" style="margin-left: 2px;" onclick="showActorRuleInfo('Villager')"></i>
				<i class="bi bi-caret-up-fill w3-display-right w3-margin-right" onclick="ExtandSection(this, 'VillagerActorSection')"></i>
			</div>
			<div id="VillagerActorSection" class="w3-container w3-row w3-show" style=""> 
			</div>
			
			<div id="GodActorTitle" class="extandSectionTitle w3-display-container w3-center w3-col-middle w3-pale-blue w3-leftbar w3-rightbar w3-border-blue"
				 ondblclick="ExtandSection($(this).find('i'), 'GodActorSection')">
				神職陣營
				<i class="bi bi-info-circle" style="margin-left: 2px;" onclick="showActorRuleInfo('God')"></i>
				<i class="bi bi-caret-up-fill w3-display-right w3-margin-right" onclick="ExtandSection(this, 'GodActorSection')"></i>
			</div>
			<div id="GodActorSection" class="w3-container w3-row w3-show" style="">
			</div>
			
			<div id="WolfActorTitle" class="extandSectionTitle w3-display-container w3-center w3-col-middle w3-pale-blue w3-leftbar w3-rightbar w3-border-blue"
				ondblclick="ExtandSection($(this).find('i'), 'WolfActorSection')">
				狼人陣營
				<i class="bi bi-info-circle" style="margin-left: 2px;" onclick="showActorRuleInfo('Wolf')"></i>
				<i class="bi bi-caret-up-fill w3-display-right w3-margin-right" onclick="ExtandSection(this, 'WolfActorSection')"></i>
			</div>
			<div id="WolfActorSection" class="w3-container w3-row w3-show" style=""> 
			</div>
			
			<div id="VictoryConditionTitle" class="extandSectionTitle w3-display-container w3-center w3-col-middle w3-pale-blue w3-leftbar w3-rightbar w3-border-blue w3-margin-top"
				 ondblclick="ExtandSection($(this).find('i'), 'VictoryConditionSection')">
				勝利條件
				<i class="bi bi-info-circle" style="margin-left: 2px;" onclick="ShowAlert('info', victoryCondition.title, victoryCondition.content);"></i>
				<i class="bi bi-caret-up-fill w3-display-right w3-margin-right" onclick="ExtandSection(this, 'VictoryConditionSection')"></i>
			</div>
			<div id="VictoryConditionSection" class="w3-container w3-row w3-show" style=""> 
				<div class="s6 m6 l6 w3-col w3-center w3-col-middle" onclick="UpdateBtn('versionMode', 'gonly')">
					<button id="gonly" class="wolf-btn wolf-btn-selected w3-btn w3-block w3-round-large versionMode">
						屠邊
					</button>
				</div>
				<div class="s6 m6 l6 w3-col w3-center w3-col-middle" onclick="UpdateBtn('versionMode', 'gnv')">
					<button id="gnv" class="wolf-btn w3-btn w3-block w3-round-large versionMode">
						屠城
					</button>
				</div>
			</div>
			
			<div id="WindowConditionTitle" class="extandSectionTitle w3-display-container w3-center w3-col-middle w3-pale-blue w3-leftbar w3-rightbar w3-border-blue" 
				 ondblclick="ExtandSection($(this).find('i'), 'WindowConditionSection')">
				畫面形式
				<i class="bi bi-caret-up-fill w3-display-right w3-margin-right" onclick="ExtandSection(this, 'WindowConditionSection')"></i>
			</div>
			<div id="WindowConditionSection" class="w3-container w3-row w3-show" style=""> 
				<div class="s6 m6 l6 w3-col w3-center w3-col-middle" onclick="UpdateBtn('windowMode', 'tableAlign')">
					<button id="tableAlign" class="wolf-btn w3-btn w3-block w3-round-large windowMode">
						表格形式<i class="bi bi-grid-3x3"></i>
					</button>
				</div>
				<div class="s6 m6 l6 w3-col w3-center w3-col-middle" onclick="UpdateBtn('windowMode', 'lrAlign')">
					<button id="lrAlign" class="wolf-btn wolf-btn-selected w3-btn w3-block w3-round-large windowMode">
						左右分隔<i class="bi bi-distribute-horizontal"></i>
					</button>
				</div>
			</div>
<!--
			<div id="OtherRuleTitle" class="extandSectionTitle w3-display-container w3-center w3-col-middle w3-pale-blue w3-leftbar w3-rightbar w3-border-blue"
				 ondblclick="ExtandSection($(this).find('i'), 'OtherRuleSection')">
				其他規則
				<i class="bi bi-caret-down-fill w3-display-right w3-margin-right" onclick="ExtandSection(this, 'OtherRuleSection')"></i>
			</div>
			<div id="OtherRuleSection" class="w3-container w3-row w3-hide" style=""> 
				<div class="s6 m6 l6 w3-col w3-center w3-col-middle" onclick="UpdateBtn('suicideMode', 'suicideModeYes')">
					<button id="suicideModeYes" class="wolf-btn w3-btn w3-block w3-round-large suicideMode">
						<B>可</B>自刀
					</button>
				</div>
				<div class="s6 m6 l6 w3-col w3-center w3-col-middle" onclick="UpdateBtn('suicideMode', 'suicideModeNo')">
					<button id="suicideModeNo" class="wolf-btn wolf-btn-selected w3-btn w3-block w3-round-large suicideMode">
						<B>不可</B>自刀
					</button>
				</div>
			</div>
-->
			<div class="w3-container w3-center w3-col-middle w3-margin-top">
				<button class="wolf-btn w3-btn w3-round-large" onclick="submitVersion()">
					開始遊戲<br/>
					<span id="submitTotalPlayer" class="">__</span>人局
				</button>
			</div>
		</div>
		<div id="actorRuleDiv" class="HiddenPopupInfo HiddenPopupInfo-L w3-container w3-center w3-round-xxlarge">
			<i class="wolf-btn-close bi bi-x-circle-fill" onclick="CloseHiddenPopupInfo()"></i>
			<div class="w3-display-container w3-center w3-col-middle w3-pale-blue w3-leftbar w3-rightbar w3-border-blue w3-large">
				<i class="bi bi-bookmark-star-fill w3-text-blue"></i>
				角色簡介
			</div>
			<table id="actorRuleInfo" class="w3-table w3-bordered w3-medium" style=""> 
			</table>
			<button class="wolf-btn w3-btn w3-round-large" onclick="CloseHiddenPopupInfo()">
				關閉
			</button>
		</div>
		<div id="alertDiv" class="HiddenPopupInfo HiddenPopupInfo-M w3-container w3-center w3-round-xxlarge">
			<i class="wolf-btn-close bi bi-x-circle-fill" onclick="CloseHiddenPopupInfo()"></i>
			<div id="alertTitle" class="w3-container w3-large"></div>
			<div id="alertContent" class="w3-container w3-medium" style=""></div>
			<div id="alertAction" class="w3-container w3-medium" style=""></div>
		</div>
	</div>
</body> 
<script>
var submitTotalPlayer = 0;
var totalActorArray = [];
var godArray = []; 
var godChinArray = [];
var villagerArray = []; 
var villagerChinArray = [];
var wolfArray = []; 
var wolfChinArray = []; 
var versionMode = 'gonly';
var windowMode = 'lrAlign';
var alignment;
var pressTimer;//

$(document).ready(function(){
	SetWindow();
	getActorList();
	if(wh>0.7){
		landscape = true;
		UpdateBtn('windowMode', 'tableAlign');
	}
}); 
$(document).on("click", '.actorImg', function(temp){
	var controlActor = temp.currentTarget.name;
	var controlActorCount = parseInt($("#actor"+controlActor+"Count").text());
	if (controlActorCount == 0){
		submitTotalPlayer++;
		$("#actor"+controlActor+"Count").text(controlActorCount+1);
		$("#actor"+controlActor+"Count").addClass("w3-pale-red");
		$("#actor"+controlActor).addClass("w3-border-red");
	}else if (controlActorCount == 1){
		if(controlActor == "Villager" || controlActor == "Wolf"){
			submitTotalPlayer++;
			$("#actor"+controlActor+"Count").text(controlActorCount+1);
			$("#actor"+controlActor+"Count").addClass("w3-pale-red");
		}else{
			submitTotalPlayer--;
			$("#actor"+controlActor+"Count").text(controlActorCount-1);
			$("#actor"+controlActor+"Count").removeClass("w3-pale-red");
			$("#actor"+controlActor).removeClass("w3-border-red");
		}
	}else if (controlActorCount == 2){
		if(controlActor == "Villager" || controlActor == "Wolf"){
			submitTotalPlayer++;
			$("#actor"+controlActor+"Count").text(controlActorCount+1);
		}
	}else if (controlActorCount == 3){
		if(controlActor == "Villager"){
			submitTotalPlayer++;
			$("#actor"+controlActor+"Count").text(controlActorCount+1);
		}else if (controlActor == "Wolf"){
			submitTotalPlayer = submitTotalPlayer-controlActorCount;
			$("#actor"+controlActor+"Count").text(0);
			$("#actor"+controlActor).removeClass("w3-border-red");
			$("#actor"+controlActor+"Count").removeClass("w3-pale-red");
		}
	}else if (controlActorCount > 3){
		if(controlActor == "Villager"){
			submitTotalPlayer = submitTotalPlayer-controlActorCount;
			$("#actor"+controlActor+"Count").text(0);
			$("#actor"+controlActor).removeClass("w3-border-red");
			$("#actor"+controlActor+"Count").removeClass("w3-pale-red");
		}
	}
	$("#submitTotalPlayer").text(translate(submitTotalPlayer));
	if(submitTotalPlayer > 12){
		UpdateBtn('windowMode', 'tableAlign');
	}
	if(submitTotalPlayer > 20){
		ShowAlert('alert', '人數錯誤','暫未支援多於' + translate(submitTotalPlayer-1) + '人局');
		selectVersion(0);
	}
});
$(document).on("taphold", '.actorImg', function(temp){
	showActorRuleInfo(temp.currentTarget.name);
});
$(document).on("taphold", '.extandSectionTitle', function(temp){
	var section = temp.currentTarget.id;
	section = section.slice(0, section.length - 5) + "Section";
	ExtandSection($(this).find('i'), section);
});
//data-long-press-delay="500" /*1000 = 1s*/
$(document).on("long-press", '.actorImg', function(temp){
	showActorRuleInfo(temp.currentTarget.name);
});
$(document).on("long-press", '.extandSectionTitle', function(temp){
	var section = temp.currentTarget.id;
	section = section.slice(0, section.length - 5) + "Section";
	ExtandSection($(this).find('i'), section);
});
function getActorList(){
	$("#VillagerActorSection").html("");
	$("#GodActorSection").html("");
	$("#WolfActorSection").html("");
	for(var i=0; i<allVillager.length; i++){
		$("#VillagerActorSection").append( 	"<div class='actorCard w3-container s3 m2 l1 w3-col w3-center w3-col-middle' style='padding: 0px;' data-long-press-delay='500'>" + 
											"	<img id='actor"+ allVillager[i] +"' class='actorImg' src='./image/actor/"+ allVillager[i] +".png' name='"+ allVillager[i] +"'> " +
											"	<p id='actor"+ allVillager[i] +"Count' name='actor"+ allVillager[i] +"Count' class='actorCount w3-border w3-round-xxlarge'>0</p>" +
											"</div>");	
	}
	for(var i=0; i<allGod.length; i++){
		$("#GodActorSection").append( 	"<div class='actorCard w3-container s3 m2 l1 w3-col w3-center w3-col-middle' style='padding: 0px;' data-long-press-delay='500'>" + 
											"	<img id='actor"+ allGod[i] +"' class='actorImg' src='./image/actor/"+ allGod[i] +".png' name='"+ allGod[i] +"'> " +
											"	<p id='actor"+ allGod[i] +"Count' name='actor"+ allGod[i] +"Count' class='actorCount w3-border w3-round-xxlarge'>0</p>" +
											"</div>");	
	}
	for(var i=0; i<allWolf.length; i++){
		$("#WolfActorSection").append( 	"<div class='actorCard w3-container s3 m2 l1 w3-col w3-center w3-col-middle' style='padding: 0px;' data-long-press-delay='500'>" + 
											"	<img id='actor"+ allWolf[i] +"' class='actorImg' src='./image/actor/"+ allWolf[i] +".png' name='"+ allWolf[i] +"'> " +
											"	<p id='actor"+ allWolf[i] +"Count' name='actor"+ allWolf[i] +"Count' class='actorCount w3-border w3-round-xxlarge'>0</p>" +
											"</div>");	
	}
}
function selectVersion(noOfPlayer){
	resetVersion();
	$("#submitTotalPlayer").text(translate(noOfPlayer));
	if(noOfPlayer == 0){
		return;
	}
	var tempArray;
	submitTotalPlayer = noOfPlayer;
	switch(noOfPlayer){
		case 6:
			UpdateBtn('versionMode', 'gnv');
			tempArray = array6;
			break;
		case 7:
			UpdateBtn('versionMode', 'gonly');
			tempArray = array7;
			break;
		case 8:
			UpdateBtn('versionMode', 'gonly');
			tempArray = array8;
			break;
		case 9:
			UpdateBtn('versionMode', 'gonly');
			tempArray = array9;
			break;
		case 10: 
			UpdateBtn('versionMode', 'gonly');
			tempArray = array10;
			break;
		case 11: 
			UpdateBtn('versionMode', 'gonly');
			tempArray = array11;
			break;
		case 12: 
			UpdateBtn('versionMode', 'gonly');
			UpdateBtn('windowMode', 'tableAlign');
			tempArray = array12;
			break;
		default:
			console.log(noOfPlayer);
			break;
	}

	for(var i=0; i<tempArray.length; i++){
		var controlActor = tempArray[i];
		var lastChar = controlActor.substring(controlActor.length - 1);
		if(lastChar == 1 || lastChar == 2 || lastChar == 3){
			controlActor = controlActor.substring(0, controlActor.length-1);
		}
		var controlActorCount = parseInt($("#actor"+controlActor+"Count").text());
		$("#actor"+controlActor+"Count").text(controlActorCount+1);
		$("#actor"+controlActor+"Count").addClass("w3-pale-red");
		$("#actor"+controlActor).addClass("w3-border-red");
	}
}
function submitVersion(){
	var prefix = "actor";
	var postfix = "Count";
	for(var i=0; i<$(".actorCount").length; i++){
		var tempActor = $(".actorCount")[i].id;
		var tempActorCount = $(".actorCount")[i].innerText;
		var prefixPosition = tempActor.indexOf(prefix);
		var postfixPosition = tempActor.indexOf(postfix);
		tempActor = tempActor.slice(prefixPosition+prefix.length, postfixPosition);
		if(tempActor.length > 0 && tempActorCount > 0){
			if(allGod.includes(tempActor)){
				for(var j=0; j<tempActorCount; j++){
					totalActorArray.push(tempActor+(j>0?j:"")); 
					godArray.push(tempActor+(j>0?j:"")); 
					godChinArray.push(translate(tempActor)+(j>0?"["+translate(j)+"]":""));
				}	
			}else if(allVillager.includes(tempActor)){
				for(var j=0; j<tempActorCount; j++){
					totalActorArray.push(tempActor+(j>0?j:"")); 
					villagerArray.push(tempActor+(j>0?j:""));
					villagerChinArray.push(translate(tempActor)+(j>0?"["+translate(j)+"]":""));
				}					
			}else if(allWolf.includes(tempActor)){
				for(var j=0; j<tempActorCount; j++){
					totalActorArray.push(tempActor+(j>0?j:"")); 
					wolfArray.push(tempActor+(j>0?j:"")); 
					wolfChinArray.push(translate(tempActor)+(j>0?"["+translate(j)+"]":"")); 
				}
			}
		}
	}
	if(!(wolfArray.length > 0 && villagerArray.length > 0 && godArray.length > 0) || totalActorArray.length < 6){
		ShowAlert('alert', '人數錯誤','最少六名玩家<br/>並且每個陣營最少要有一名玩家');
		selectVersion(0);
		return;
	}
	
	/*versionLog += "版本：<br/>玩家："+translate(submitTotalPlayer)+"人<br/>屠邊："+translate(versionMode)+"<br/>角色分佈：";
	versionLog += "<table class='w3-topbar w3-bottombar w3-border-blue w3-pale-blue' style='width:100%'>";
	versionLog += "<tr><td style='width:40px;'>神職</td><td>"+godChinArray.toString()+"</td></tr>";
	versionLog += "<tr><td>平民</td><td>"+villagerChinArray.toString()+"</td></tr>";
	versionLog += "<tr><td>狼人</td><td>"+wolfChinArray.toString()+"</td></tr>";
	versionLog += "</table><br/>";
	$("#log").html(versionLog);*/
	//closePopUp();
	//startNewGame();
	//showVersion();
	var passParam = {
		setWidth: setWidth,
		setHeight: setHeight,
		totalActorArray: totalActorArray,
		godArray: godArray,
		godChinArray: godChinArray,
		villagerArray: villagerArray,
		villagerChinArray: villagerChinArray,
		wolfArray: wolfArray,
		wolfChinArray: wolfChinArray,
		versionMode: versionMode,
		windowMode: windowMode
	};
	GoPage("WolfKiller", passParam);
}
function resetVersion(){
	submitTotalPlayer = 0;
	$(".actorCount").text("0");
	$(".actorImg").removeClass("w3-border-red");
	$(".actorCount").removeClass("w3-pale-red");
	totalActorArray = [];
	godArray = [];
	villagerArray = [];
	wolfArray = [];
	UpdateBtn('versionMode','gonly');
}
function showActorRuleInfo(input){
	$("#actorRuleInfo").html("");
	var tempActorList = [];
	if(input == "God"){
		tempActorList = allGod;
	}else if(input == "Wolf"){
		tempActorList = allWolf;
	}else{
		tempActorList.push(input);
	}
	
	for(var i=0; i<tempActorList.length; i++){
		$("#actorRuleInfo").append( 	"<tr> " +
										"	<td class='w3-col s2 m2 l1' style='float: none; vertical-align: middle; padding: 2px;'>" +
										"		<img class='actorImg' src='./image/actor/"+ tempActorList[i] +".png'/> " +
										"	</td>" +
										"	<td class='w3-col s3 m2 l2' style='float: none; vertical-align: middle; padding: 2px;'>" + 
										"		<span class='actorName' class=''>"+ translate(tempActorList[i])+"</span>" + 
										"	</td>" + 
										"	<td class='w3-col s7 m8 l9' style='float: none; vertical-align: middle; padding: 2px;'>" + 
										"		<span class='actorRule' class=''>"+allActorRule[tempActorList[i]] +"</span>" + 
										"	</td>" +
										"</tr>");	
	}
	$("#actorRuleDiv").css("display","block");
}
</script>
</html>